<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merkel Vision - New Layout</title>
    
    <!-- Keep existing auth CSS -->
    <link rel="stylesheet" href="css/auth-loading.css?v=1.2.1755401200">
    <link rel="stylesheet" href="css/security-enhanced.css?v=1.2.1755401200">
    
    <!-- Add optimized layout CSS -->
    <link rel="stylesheet" href="js/layout/test-layout-base.css">
    <link rel="stylesheet" href="js/layout/test-layout-components-optimized.css">
    <link rel="stylesheet" href="js/layout/test-layout-responsive-optimized.css">
    
    <!-- Keep immediate auth check -->
    <script src="js/auth-immediate-check.js?v=1.2.1755310728"></script>
</head>
<body>
    <!-- Keep existing auth loading -->
    <div id="authLoading" class="auth-loading">
        <div class="loading-spinner"></div>
        <div>Verifying authentication...</div>
    </div>
    
    <!-- NEW: Combined layout with auth integration -->
    <div id="appContent" class="app-content">
        <!-- Cache Management - Initialize before main app -->
        <script type="module" src="js/cache-init.js?v=1.2.1755401200"></script>
        
        <!-- External JavaScript for CSP compliance -->
        <script type="module" src="js/app-page.js?v=1.2.1755401200"></script>
        

        <div class="container">
            <!-- NEW: Enhanced search bar (floating top-center) -->
            <div class="floating-search-section">
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Search for a place..." autocomplete="off">
                        <button id="searchButton">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="suggestions" class="suggestions"></div>
                </div>
            </div>
            
            <!-- NEW: Full-screen map background -->
            <div id="map" class="map-container">
            </div>
            
           <!-- NEW: Left sidebar with app controls -->
<div class="sidebar-overlay">
    <div class="app-logo">MERK</div>
    
    <div class="sidebar-button" id="map-button">
        <button class="button" title="Reset to default layout">
            <svg class="button-icon" id="map-icon" viewBox="0 0 21.9 36.36" aria-label="Map location">
                <path d="M20.05,33.7c0-1.21-2.74-2.22-6.49-2.55-.77,1.17-1.35,2-1.57,2.33-.24.34-.62.54-1.04.54s-.8-.2-1.04-.54c-.23-.32-.8-1.16-1.57-2.33-3.75.33-6.49,1.35-6.49,2.55,0,1.47,4.07,2.66,9.1,2.66s9.1-1.19,9.1-2.66Z"/>
                <path d="M9.81,31.06c.7,1.06,1.14,1.7,1.14,1.7,0,0,.44-.64,1.14-1.7,2.8-4.23,9.81-15.27,9.81-20.11C21.9,4.9,17,0,10.95,0S0,4.9,0,10.95c0,4.84,7,15.88,9.81,20.11ZM10.95,4.38c3.53,0,6.39,2.86,6.39,6.39s-2.86,6.39-6.39,6.39-6.39-2.86-6.39-6.39,2.86-6.39,6.39-6.39Z"/>
            </svg>
        </button>
    </div>
    
    <div class="sidebar-button" id="data-location-button">
        <button class="button secondary" title="Toggle map data collection">
            <svg class="button-icon" viewBox="0 0 24 24" aria-label="Data collection">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
        </button>
    </div>
    
    <div class="sidebar-button" id="center-map-button">
        <button class="button" title="Center map on current location">
            <svg class="button-icon" viewBox="0 0 24 24" aria-label="Center map">
                <path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
            </svg>
        </button>
    </div>
    
    <!-- RESTORED: Profile button with user info integration -->
    <div class="sidebar-button" id="profile-button">
        <button class="button" title="User profile and settings">
            <svg class="button-icon" viewBox="0 0 24 24" aria-label="Profile">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
        </button>
    </div>
</div>
            <!-- NEW: Vertical resizer -->
<div id="vertical-resizer" class="vertical-resizer"></div>
            <!-- NEW: Right sidebar with dynamic content -->
            <div id="right-sidebar-overlay" class="right-sidebar-overlay">
                <div class="right-sidebar-header">
                    <h3>üìç Saved Locations</h3>
                    <button class="close-button">√ó</button>
                </div>
                <div class="right-sidebar-content">
                    <div class="sidebar-actions">
                        <button id="clickToSaveBtn" class="action-button">
                            üìç Click to Save Location
                        </button>
                    </div>
                    <div id="savedLocationsList" class="saved-locations-list">
                        <div class="no-saved-locations">
                            <p>No saved locations yet</p>
                            <p class="hint">Search for a place and click "Save Location" to add it here</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- NEW: Floating buttons group -->
            <div id="floating-button-group" class="floating-button-group">
                <div id="layer-button" class="floating-button layer-button">
                    <span class="button-text">üó∫Ô∏è</span>
                </div>
                <div id="save-location-button" class="floating-button save-button">
                    <span class="button-text">üìç</span>
                </div>
                <div id="expand-button" class="floating-button expand-button">
                    <span class="button-text">></span>
                </div>
            </div>
        </div>
        
        <!-- Keep existing profile modal -->
        <div id="profileModal" class="modal">
            <!-- ... keep your existing modal content ... -->
        </div>
    </div>

    <!-- Load existing modules first -->
    <script type="module" src="js/initMap.js"></script>
    
    <!-- Load new layout controls -->
    <script src="js/layout/test-layout-control-buttons.js"></script>
    <script type="module" src="js/layout/LayoutController.js"></script>
    
    <!-- Load integration bridge -->
    <script src="layout-integration-bridge.js"></script>
    
    <!-- Keep existing app page script -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCHQECnK2DXcNXIQR0ZfvIEPrAJWIH8JsM&libraries=places"></script>
</body>
</html>